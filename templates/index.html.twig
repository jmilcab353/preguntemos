{% extends 'base.html.twig' %}

{% block body %}
<div class="container my-5">

    <h1 class="text-center">Preguntemos!</h1>
    <p class="text-center">El juego de preguntas interactivas hecho en Symfony</p>

    {% if app.user %}
        <p class="text-center">Hola, <strong>{{ app.user.userIdentifier }}</strong></p>
    {% endif %}

    {# Flash messages display section #}
    {% for label, messages in app.flashes %}
        <div class="alert alert-{{ label }}">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endfor %}

    <div id="main-content" class="row">
        {# DIV 2/3 width Pregunta actual #} 
        <div class="col-md-8">
            {# Form to choose the correct answer, send it to the database and also reveal the correct answer #}
            <div id="choose-answer" class="card mb-4">
                <div class="card-body">
                    {% if app.user %}
                        <form action="{{ path('choose_answer') }}" method="post">
                            <h5 class="card-title">Pregunta: {{ question.questionText }}</h5>

                            <!-- Include user ID and question ID in the form -->
                            <input type="hidden" name="user_id" value="{{ app.user.id }}">
                            <input type="hidden" name="question_id" value="{{ question.id }}">

                            <div class="form-check">
                                <input type="radio" name="answer" value="1" id="answer_one" class="form-check-input">
                                <label for="answer_one" class="form-check-label">{{ question.answerOne }}</label>
                            </div>

                            <div class="form-check">
                                <input type="radio" name="answer" value="2" id="answer_two" class="form-check-input">
                                <label for="answer_two" class="form-check-label">{{ question.answerTwo }}</label>
                            </div>

                            <div class="form-check">
                                <input type="radio" name="answer" value="3" id="answer_three" class="form-check-input">
                                <label for="answer_three" class="form-check-label">{{ question.answerThree }}</label>
                            </div>

                            <div class="form-check">
                                <input type="radio" name="answer" value="4" id="answer_four" class="form-check-input">
                                <label for="answer_four" class="form-check-label">{{ question.answerFour }}</label>
                            </div>

                            <button type="submit" class="btn btn-primary mt-3">Enviar respuesta</button>
                        </form>
                    {% else %}
                        <p class="text-danger">Debes iniciar sesión para responder la pregunta.</p>
                    {% endif %}
                </div>
            </div>

            {% if app.user %}
                <div id="correct-answer" class="card">
                    <div class="card-body">
                        <button class="btn btn-secondary mb-2" onclick="document.getElementById('correct-answer-text').classList.toggle('d-none')">
                            Ver respuesta
                        </button>
                        <p id="correct-answer-text" class="d-none">Respuesta correcta: <strong>{{ question.correctAnswer }}</strong></p>
                    </div>
                </div>
            {% endif %}
        </div>

        {# DIV 1/3 width (insert dynamic chart here later with Chart.js) #} 
        <div id="dynamic-chart" class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Estadísticas</h5>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{# Added for debugging purposes #}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(event) {
                // Confirm form submission
                console.log('Form submitted');
            });
        } else {
            console.log("Form not found");
        }
        
        if (form) {
            form.addEventListener('submit', function(event) {
                // Prevent form submission for debugging
                event.preventDefault();
                
                // Log form data
                const formData = new FormData(form);
                formData.forEach((value, key) => {
                    console.log(key + ": " + value);  // Print each field's name and value
                });;

                // Optionally submit the form after logging data
                form.submit(); // Uncomment this line to actually submit the form after logging
            });
        } else {
            console.log("Form not found");
        }
    });
</script>
{% endblock %}
